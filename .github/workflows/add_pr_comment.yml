# This is a basic workflow to help you get started with Actions

name: Run static code analyzer Lint

on:
  pull_request:
    types: [ labeled ]
  push:

jobs:
  test:
    if: ${{ github.event.label.name == 'build:lint' }}
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
    - uses: actions/checkout@v1.0.0
    - uses: julia-actions/setup-julia@v1
      with:
        version: '1.10'

    - name: Get changed files
      id: changed-files
      uses: tj-actions/changed-files@v42
      # To compare changes between the current commit and the last pushed remote commit set `since_last_remote_commit: true`. e.g
      # with:
      #   since_last_remote_commit: true 

    - name: List all changed files
      env:
        ALL_CHANGED_FILES: ${{ steps.changed-files.outputs.all_changed_files }}
      run: |
        for file in ${ALL_CHANGED_FILES}; do
          echo "$file" >> files_to_run_lint.txt
          echo "$file was changed"
        done
          
    - name: Run lint
      run: bash run_static_lint.sh ${ALL_CHANGED_FILES}
      
    - uses: mshick/add-pr-comment@v2
      if: always()
      with:
        message-path: result.txt
        # refresh-message-position: true
        # allow-repeats: true
